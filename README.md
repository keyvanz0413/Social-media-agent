# 🚀 Social Media Multi-Agent System

基于 ConnectOnion 框架构建的**新一代智能社交媒体内容创作系统**，融合多模型协同、多模态处理、自适应流程和 MCP 集成。

> 💡 **核心理念**：从"固定流水线"进化到"智能编排系统"，让 AI Agent 根据内容特点动态调整创作策略。

## ✨ 核心特性

### 🤖 Multi-Agent 协作架构（7个专业 Agent）

#### 内容创作流水线
- **Agent A - 多源数据分析师**
  - 爬取小红书、抖音、知乎等多平台热门内容
  - 使用 **Qwen2.5-VL** 分析视觉叙事规律
  - 提取爆款特征（标题、结构、图片、情绪）
  
- **Agent B - 智能图片专家**
  - 支持 DALL-E 3、Midjourney、Stable Diffusion 多引擎
  - **热备切换**：主服务失败自动切换备用
  - **质量预测**：生成前评估，低于 8 分重新生成
  
- **Agent C - 渐进式内容创作者**
  - 分步创作：标题 → 大纲 → 正文（每步评审）
  - **模型串联优化**：Claude 初稿 → GPT-4o 逻辑优化 → Claude 文学润色
  - 自动适配多平台风格（小红书、公众号、抖音）

#### 智能评审团队
- **Agent D - 互动潜力评审**（GPT-4o-mini）
  - 评估点赞、评论、转发可能性
  - 分析标题吸引力、内容实用性、情绪共鸣
  
- **Agent E - 内容质量评审**（GPT-4o-mini）
  - 语法、逻辑、原创性、可读性
  - 段落结构、信息密度、叙事节奏
  
- **Agent F - 合规检查评审**（Ollama 本地）
  - 敏感词、广告法、平台规则
  - **数据不出本地**，保护隐私
  
- **Agent G - 用户视角模拟**（Claude）
  - 模拟目标用户画像（年龄、性别、兴趣）
  - "我作为一个 28 岁女性会点赞吗？"

#### 主协调器
- **智能路由**：根据关键词热度、数据质量动态调整流程
- **自适应流程**：热门词正常流程，冷门词跳过分析直接创作
- **质量控制**：首次评分 > 9.5 快速发布，< 6.0 人工介入

### 🧠 多模型协同策略

#### 模型选择矩阵
| 任务类型 | 主模型 | 备用模型 | 选择理由 |
|---------|-------|---------|---------|
| 深度分析、策略制定 | GPT-4o | GPT-4o-mini | 推理能力最强 |
| 创意写作、标题生成 | Claude-3.5-Sonnet | GPT-4o | 文学性和感染力强 |
| 快速评审、打分 | GPT-4o-mini | Claude-haiku | 性价比高、速度快 |
| 图像理解、视觉分析 | Qwen2.5-VL | GPT-4o-vision | 中文多模态能力优秀 |
| 合规检查（隐私） | Ollama (llama3.2) | GPT-4o-mini | 数据不出本地 |

#### 高级协同模式

**1. 模型投票机制**
```
关键决策（如标题选择）：
├─ GPT-4o 生成版本 A
├─ Claude 生成版本 B  
├─ GPT-4o-mini 生成版本 C
└─ 三个模型交叉投票 → 选出最佳版本
```

**2. 模型串联优化**
```
创意初稿 (Claude) → 逻辑优化 (GPT-4o) → 文学润色 (Claude)
成本：$0.08  质量提升：40%  vs 单模型
```

**3. 渐进式质量控制**
```
草稿阶段：GPT-4o-mini（快速迭代）
精修阶段：GPT-4o（高质量输出）
最终润色：Claude（文学性）
节省成本：47%  vs 全程 GPT-4o
```

**4. 动态模型选择**
```python
if keyword in ["科技", "数码"]:
    model = "gpt-4o"  # 逻辑性强
elif keyword in ["旅游", "美食", "时尚"]:
    model = "claude"  # 感染力强
elif keyword in ["理财", "法律"]:
    model = "gpt-4o" + "本地合规检查"
```

### 🎨 多模态创新能力

#### 1. 视觉叙事分析
```
分析热门帖子的图片序列：
图1（封面·全景）→ 图2（细节·特写）→ 图3（人物·互动）→ 图4（结尾·回味）

提取规律：
- 视觉节奏（从全景到特写 or 相反）
- 色调演变（从冷色到暖色制造情绪变化）
- 情绪曲线（开篇吸引 → 中间高潮 → 结尾共鸣）
```

#### 2. 图片质量预测系统
```
生成 prompt → 预测评分 → 低于 8 分 → 优化 prompt → 重新生成
评分维度：构图平衡、色彩和谐、主体突出、平台风格匹配
避免浪费：减少 60% 无效生成
```

#### 3. OCR 辅助创作
```
爆款图片 → OCR 提取文字 → 分析文字布局规律
- 标题位置：上方居中，字号 48px
- 关键词：黄色高亮，粗体
- 辅助信息：底部，灰色小字

指导新图片生成时的文字排版
```

#### 4. 图文匹配验证
```
标题 + 正文 + 图片 → Qwen2.5-VL 分析 → 匹配度评分
- 语义相关性：图片内容是否与文字呼应
- 情绪一致性：图片情绪是否与文字情绪匹配
- 风格协调性：视觉风格是否统一
匹配度 < 7.0 → 重新生成图片
```

### 🔌 MCP 集成架构

#### MCP 编排层（Orchestration Layer）
```
Agent 工具函数
    ↓
MCP Orchestrator（智能编排）
├─ 负载均衡：多个 MCP 实例轮询
├─ 自动重试：失败重试 3 次，指数退避
├─ 降级策略：主服务不可用切换备用
├─ 结果缓存：相同请求 24 小时内返回缓存
└─ 结果聚合：调用多个 MCP 并融合数据
    ↓
[MCP-A] [MCP-B] [MCP-C]
```

#### MCP 服务矩阵

| MCP Server | 功能 | 主服务 | 备用服务 | 超时 |
|-----------|------|--------|---------|------|
| **数据获取** | 热门内容爬取 | 小红书官方API | 爬虫方案 | 30s |
| **图片生成** | AI 生成图片 | DALL-E 3 | Midjourney / SD本地 | 120s |
| **多模态** | 图像理解 | Qwen2.5-VL | GPT-4o-vision | 30s |
| **内容审核** | 合规检查 | 第三方审核API | 本地敏感词库 | 10s |
| **数据分析** | 第三方数据 | 微信、抖音数据 | - | 30s |

#### MCP 高级特性

**1. 结果聚合**
```
调用 3 个小红书数据源 MCP：
├─ MCP-A：官方 API（最新但可能限流）
├─ MCP-B：爬虫方案（全面但可能过时）
└─ MCP-C：第三方平台（补充数据）

聚合策略：
- 去重（相同帖子ID）
- 融合（综合多源的点赞数、评论数）
- 验证（交叉验证数据准确性）
```

**2. 热备切换**
```
图片生成流程：
1. 尝试 DALL-E 3 MCP（高质量）
2. 失败 → 切换 Midjourney MCP（更稳定）
3. 仍失败 → 切换 Stable Diffusion 本地（最稳定）
4. 仍失败 → 从 Unsplash 搜索真实图片（兜底）

可用性：99.9%+
```

## 📊 自适应工作流程

### 智能流程图（根据数据质量自动调整）

```
用户输入："澳洲旅游"
         ↓
┌─────────────────────────────────────────────┐
│   主协调 Agent (GPT-4o)                      │
│   - 分析关键词热度                            │
│   - 选择最优流程路径                          │
│   - 动态调度子 Agent                         │
└─────────────────────────────────────────────┘
         ↓
    ┌─────────┐
    │热门词？  │
    └─────────┘
      Yes ↓              No → 跳到阶段 3（使用通用模板）
         ↓
┌──────────────────────────────────────────────────────┐
│  阶段 1：多源数据获取 (并行)                          │
│  ├─ MCP 1: 小红书官方 API                            │
│  ├─ MCP 2: 小红书爬虫                                │
│  ├─ MCP 3: 抖音相关内容                              │
│  └─ MCP 4: 知乎优质回答                              │
│  聚合结果 → 去重 → 验证                              │
└──────────────────────────────────────────────────────┘
         ↓
┌──────────────────────────────────────────────────────┐
│  阶段 2：智能分析 (Agent A + 多模态)                  │
│  ├─ GPT-4o: 分析文字特征                             │
│  │   - 标题风格、情绪色调、结构套路                   │
│  ├─ Qwen2.5-VL: 分析视觉叙事                         │
│  │   - 图片序列、色调演变、视觉节奏                   │
│  └─ 输出：创作策略 + 视觉指南                         │
└──────────────────────────────────────────────────────┘
         ↓
┌──────────────────────────────────────────────────────┐
│  阶段 3：渐进式创作 (Agent B & C)                     │
│  ├─ 3.1 标题生成（模型投票）                          │
│  │   - GPT-4o 生成 3 个版本                          │
│  │   - Claude 生成 3 个版本                          │
│  │   - GPT-4o-mini 评选最佳 → "澳洲大洋路3天攻略" ✓   │
│  ├─ 3.2 大纲生成（结构化）                            │
│  │   - GPT-4o 生成逻辑大纲                           │
│  │   - 评审通过 ✓                                    │
│  ├─ 3.3 图片生成（并行 + 质量预测）                   │
│  │   - DALL-E 3 生成 7 张图                          │
│  │   - Qwen2.5-VL 质量评分：8.5/10 ✓                │
│  │   - 图文匹配检查通过 ✓                            │
│  └─ 3.4 正文创作（模型串联）                          │
│      - Claude 初稿（创意性）                          │
│      - GPT-4o 优化（逻辑性）                          │
│      - Claude 润色（文学性）✓                         │
└──────────────────────────────────────────────────────┘
         ↓
┌──────────────────────────────────────────────────────┐
│  阶段 4：多维度评审 (并行 + 加权)                     │
│  ├─ Agent D: 互动潜力 (GPT-4o-mini) → 8.8/10        │
│  │   "标题吸引力强，有悬念感"                         │
│  ├─ Agent E: 内容质量 (GPT-4o-mini) → 9.2/10        │
│  │   "结构清晰，信息密度合理"                         │
│  ├─ Agent F: 合规检查 (Ollama 本地) → 10.0/10       │
│  │   "无敏感词，符合平台规则"                         │
│  └─ Agent G: 用户视角 (Claude) → 8.5/10             │
│      "作为 28 岁女性，我会收藏这篇攻略"                │
│  ────────────────────────────────────────────────    │
│  加权平均分：(0.4×8.8 + 0.35×9.2 + 0.15×10 + 0.1×8.5) │
│           = 9.03 分 ✓                                │
└──────────────────────────────────────────────────────┘
         ↓
    ┌──────────┐
    │≥ 9.5 分？ │ ── Yes → 快速发布（跳过修改）
    └──────────┘
         ↓ No
    ┌──────────┐
    │≥ 8.0 分？ │ ── Yes → 进入发布流程
    └──────────┘
         ↓ No
    ┌──────────┐
    │≥ 6.0 分？ │ ── Yes → 根据反馈修改（最多 3 次）
    └──────────┘         ↓
         ↓ No          返回阶段 3.4
    人工介入           （聚焦修改正文）
         ↓
┌──────────────────────────────────────────────────────┐
│  阶段 5：多平台适配发布                                │
│  ├─ 小红书版本：图片为主，文字精炼，emoji 丰富         │
│  ├─ 微信公众号版本：长文深度，段落清晰，无 emoji       │
│  └─ 抖音脚本版本：提取视频脚本，15 秒一个点            │
│  ────────────────────────────────────────────────    │
│  发布到小红书 MCP → 返回帖子链接 ✓                    │
│  https://xiaohongshu.com/posts/123456                │
└──────────────────────────────────────────────────────┘
         ↓
┌──────────────────────────────────────────────────────┐
│  阶段 6：效果追踪与学习 (24 小时后)                    │
│  ├─ 获取真实数据：点赞 12,340 / 评论 856 / 收藏 5,621│
│  ├─ 对比预测：实际表现超出预期 18%                     │
│  ├─ 提取成功因素：标题的悬念感 + 图片的色调对比        │
│  └─ 更新知识库：存入"澳洲旅游"最佳实践库              │
└──────────────────────────────────────────────────────┘
```

### 关键流程决策点

| 决策点 | 条件 | 动作 |
|-------|------|------|
| **流程选择** | 关键词热度 > 5000 | 完整流程（含数据分析） |
|  | 关键词热度 < 5000 | 简化流程（跳过分析） |
| **快速发布** | 首次评分 ≥ 9.5 | 跳过修改，直接发布 |
| **正常发布** | 首次评分 ≥ 8.0 | 进入发布流程 |
| **迭代优化** | 8.0 > 评分 ≥ 6.0 | 修改 1-3 次 |
| **人工介入** | 评分 < 6.0 或 修改 3 次仍不达标 | 暂停，请求人工审核 |

## 🏗️ 项目结构（规划）

```
Social-media-agent/
├── README.md                        # 📖 项目说明（当前文件）
├── DEVELOPMENT.md                   # 📝 开发文档（详细设计思路）
├── config.py                        # ⚙️ 全局配置（已创建）
├── requirements.txt                 # 📦 依赖管理（已创建）
├── env.example                      # 🔐 环境变量模板（已创建）
│
├── agent.py                         # 🎯 主协调 Agent 入口（待开发）
│
├── sub_agents/                      # 🤖 子 Agent 工具函数（待开发）
│   ├── __init__.py
│   ├── content_analyst.py          # Agent A: 多源数据分析
│   ├── image_generator.py          # Agent B: 智能图片生成
│   ├── content_creator.py          # Agent C: 渐进式内容创作
│   ├── reviewers.py                # Agent D/E/F/G: 评审团队
│   └── publisher.py                # 多平台发布工具
│
├── mcp_integrations/               # 🔌 MCP 编排层（待开发）
│   ├── __init__.py
│   ├── orchestrator.py             # MCP 智能编排器（核心）
│   ├── xiaohongshu_client.py      # 小红书 MCP 客户端
│   ├── image_gen_client.py        # 图片生成 MCP（多引擎）
│   ├── multimodal_client.py       # 多模态 MCP（Qwen2.5-VL）
│   └── compliance_client.py       # 内容审核 MCP
│
├── prompts/                        # 💭 提示词工程（待开发）
│   ├── coordinator.md             # 主协调 Agent 提示词
│   ├── analyst.md                 # 内容分析 Agent 提示词
│   ├── creator.md                 # 内容创作 Agent 提示词
│   ├── reviewers.md               # 评审 Agents 提示词
│   └── prompt_templates.json      # 动态提示词模板库
│
├── utils/                          # 🛠️ 工具函数（待开发）
│   ├── __init__.py
│   ├── model_router.py            # 多模型智能路由器
│   ├── data_parser.py             # JSON 数据解析与聚合
│   ├── score_calculator.py        # 加权评分计算
│   ├── cache_manager.py           # 多级缓存管理
│   └── logger.py                  # 结构化日志系统
│
├── outputs/                        # 📁 输出文件（自动创建）
│   ├── images/                    # 生成的图片
│   ├── drafts/                    # 草稿版本历史
│   ├── logs/                      # 运行日志
│   └── analytics/                 # 效果追踪数据
│
└── tests/                          # 🧪 测试套件（待开发）
    ├── test_mcp_orchestrator.py
    ├── test_sub_agents.py
    ├── test_model_router.py
    └── test_workflow.py
```

**当前状态**：✅ 架构设计完成，配置文件已创建，待实现核心功能模块。

## 🚀 快速开始

### 前置准备

#### 1. 安装依赖
```bash
cd Social-media-agent
pip install -r requirements.txt
```

#### 2. 配置环境变量
```bash
cp env.example .env
```

编辑 `.env` 文件，配置以下内容：

**必需配置（至少一个）：**
```bash
# 选项 A：使用 OpenAI（推荐，功能最全）
OPENAI_API_KEY=sk-your-openai-key-here

# 选项 B：使用 Claude（创意写作最强）
ANTHROPIC_API_KEY=sk-ant-your-anthropic-key-here

# 选项 C：使用本地 Ollama（免费，数据隐私）
OLLAMA_BASE_URL=http://localhost:11434/v1
```

**可选配置（增强功能）：**
```bash
# MCP Servers（如果有可用的 MCP 服务）
MCP_XIAOHONGSHU_URL=http://localhost:8001
MCP_IMAGE_GEN_URL=http://localhost:8002
MCP_MULTIMODAL_URL=http://localhost:8003
MCP_COMPLIANCE_URL=http://localhost:8004

# 业务参数
REVIEW_THRESHOLD=8.0
MAX_REVISIONS=3
AUTO_PUBLISH=false
```

#### 3. 配置本地 Ollama（可选）
如果使用本地模型：
```bash
# 安装 Ollama
curl -fsSL https://ollama.com/install.sh | sh

# 下载模型
ollama pull llama3.2

# 启动服务
ollama serve
```

### 使用示例

#### 命令行交互模式（规划中）
```bash
python agent.py
```

预期交互流程：
```
🚀 Social Media Agent 已启动！

👤 你: 我想发表一篇关于澳洲旅游的帖子

🤖 协调器: 收到！开始智能分析...
    - 关键词热度：高 ✓
    - 选择流程：完整流程（含数据分析）

┌─ 阶段 1：多源数据获取 ─────────────────┐
│ 🔍 [MCP] 小红书官方 API: 获取中...      │
│ 🔍 [MCP] 小红书爬虫: 获取中...          │
│ 🔍 [MCP] 抖音数据: 获取中...            │
│ ✓ 聚合完成：找到 15 篇爆款帖子          │
└────────────────────────────────────────┘

┌─ 阶段 2：智能分析 ─────────────────────┐
│ 🧠 [GPT-4o] 分析文字特征...             │
│   - 标题套路：地点 + 数字 + 悬念        │
│   - 情绪色调：兴奋、期待、实用          │
│ 🎨 [Qwen2.5-VL] 分析视觉叙事...        │
│   - 图片序列：全景→细节→人物→回味      │
│   - 色调：明亮、饱和度高、暖色系        │
│ ✓ 创作策略生成完成                      │
└────────────────────────────────────────┘

┌─ 阶段 3：渐进式创作 ───────────────────┐
│ 📝 [标题] 模型投票机制...               │
│   - GPT-4o 版本：澳洲大洋路完整攻略     │
│   - Claude 版本：🦘澳洲3天2夜玩法       │
│   - 投票结果：选择 Claude 版本 ✓        │
│                                          │
│ 🎨 [图片] DALL-E 3 生成中...            │
│   - 已生成 7/7 张图片                    │
│   - Qwen2.5-VL 质量评分：8.5/10 ✓      │
│                                          │
│ ✍️ [正文] 模型串联优化...               │
│   - Claude 初稿（1200字）✓              │
│   - GPT-4o 逻辑优化 ✓                   │
│   - Claude 文学润色 ✓                   │
└────────────────────────────────────────┘

┌─ 阶段 4：多维度评审 (并行) ────────────┐
│ 👥 [Agent D] 互动潜力: 8.8/10          │
│    "标题有悬念感，吸引力强"              │
│ 📖 [Agent E] 内容质量: 9.2/10          │
│    "结构清晰，信息密度合理"              │
│ 🛡️ [Agent F] 合规检查: 10.0/10         │
│    "无敏感词，符合规则"                  │
│ 🎭 [Agent G] 用户视角: 8.5/10          │
│    "我会收藏这篇攻略"                    │
│ ─────────────────────────────────────  │
│ ⭐ 加权平均分：9.03/10 ✅ 通过！        │
└────────────────────────────────────────┘

🚀 准备发布到小红书...
   ✓ 发布成功！
   📱 帖子链接：https://xiaohongshu.com/posts/123456
   
📊 24 小时后将自动追踪效果数据
```

#### API 调用模式（规划中）
```python
from agent import SocialMediaAgent

# 创建 Agent 实例
agent = SocialMediaAgent()

# 方式 1：一键生成并发布
result = agent.create_post(
    keyword="澳洲旅游",
    platform="xiaohongshu",
    auto_publish=False  # 需要人工确认
)

print(result)
# {
#     "status": "success",
#     "draft_id": "draft_123",
#     "title": "🦘澳洲大洋路3天2夜攻略",
#     "score": 9.03,
#     "images": ["image1.jpg", ...],
#     "publish_url": None  # 未发布
# }

# 方式 2：分步控制
# 步骤 1：分析
analysis = agent.analyze_topic("澳洲旅游")

# 步骤 2：生成草稿
draft = agent.create_draft(analysis)

# 步骤 3：评审
review = agent.review_draft(draft)

# 步骤 4：发布（如果满意）
if review["score"] >= 8.0:
    result = agent.publish(draft, platform="xiaohongshu")
```

## 📈 性能指标（预期）

| 指标 | 数值 | 说明 |
|------|------|------|
| 端到端耗时 | 90-180秒 | 含数据获取、分析、创作、评审 |
| 平均成本 | $0.08-0.15 | 使用渐进式质量控制策略 |
| 评审通过率 | 85%+ | 首次评审通过率 |
| 图片质量 | 8.5+/10 | Qwen2.5-VL 评分 |
| 系统可用性 | 99.9%+ | MCP 热备切换保障 |

## 📚 详细文档

- **[开发文档](DEVELOPMENT.md)** - 完整的设计思路、技术选型和实现方案
- **[配置文档](config.py)** - 所有可配置参数的说明
- **API文档** - 待实现后补充

## 🛣️ 开发路线图

### Phase 1：核心功能（2-3周）
- [x] 项目架构设计
- [x] 配置文件和文档
- [ ] 实现 MCP 编排层
- [ ] 实现基础 Agent 工具函数
- [ ] 实现主协调 Agent

### Phase 2：增强功能（2-3周）
- [ ] 多模型协同机制
- [ ] 多模态处理能力
- [ ] 渐进式创作流程
- [ ] 评审投票机制

### Phase 3：优化与扩展（2-3周）
- [ ] 性能优化（并行、缓存）
- [ ] 多平台适配
- [ ] 效果追踪与学习
- [ ] A/B测试系统

### Phase 4：生产就绪（1-2周）
- [ ] 完整测试覆盖
- [ ] 错误处理和日志
- [ ] 部署文档
- [ ] 监控和告警

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License

---

**⭐ 如果这个项目对你有帮助，请给个 Star！**

